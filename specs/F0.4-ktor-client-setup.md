# F0.4: Ktor Client Setup

## Objective
Add Ktor Client for future API communication. No backend yet - just structure.

## Requirements
- [ ] Ktor client dependencies added
- [ ] Platform-specific engines configured (OkHttp for Android, Darwin for iOS)
- [ ] JSON serialization configured with kotlinx.serialization
- [ ] Base HTTP client wrapper created
- [ ] Client can be injected via Koin

## Dependencies to Add

### gradle/libs.versions.toml
```toml
[versions]
ktor = "2.3.7"
kotlinx-serialization = "1.6.2"

[libraries]
ktor-client-core = { module = "io.ktor:ktor-client-core", version.ref = "ktor" }
ktor-client-okhttp = { module = "io.ktor:ktor-client-okhttp", version.ref = "ktor" }
ktor-client-darwin = { module = "io.ktor:ktor-client-darwin", version.ref = "ktor" }
ktor-client-content-negotiation = { module = "io.ktor:ktor-client-content-negotiation", version.ref = "ktor" }
ktor-serialization-json = { module = "io.ktor:ktor-serialization-kotlinx-json", version.ref = "ktor" }
ktor-client-logging = { module = "io.ktor:ktor-client-logging", version.ref = "ktor" }
kotlinx-serialization-json = { module = "org.jetbrains.kotlinx:kotlinx-serialization-json", version.ref = "kotlinx-serialization" }

[plugins]
kotlinx-serialization = { id = "org.jetbrains.kotlin.plugin.serialization", version.ref = "kotlin" }
```

## HTTP Client Structure

### commonMain - data/remote/HttpClientFactory.kt
```kotlin
package com.cooleymd.reminders.data.remote

import io.ktor.client.*
import io.ktor.client.plugins.contentnegotiation.*
import io.ktor.client.plugins.logging.*
import io.ktor.serialization.kotlinx.json.*
import kotlinx.serialization.json.Json

expect fun createHttpClient(): HttpClient

fun createBaseHttpClient(engine: HttpClientEngine): HttpClient {
    return HttpClient(engine) {
        install(ContentNegotiation) {
            json(Json {
                ignoreUnknownKeys = true
                isLenient = true
                prettyPrint = true
            })
        }
        install(Logging) {
            level = LogLevel.BODY
        }
    }
}
```

### androidMain
```kotlin
actual fun createHttpClient(): HttpClient {
    return createBaseHttpClient(OkHttp.create())
}
```

### iosMain
```kotlin
actual fun createHttpClient(): HttpClient {
    return createBaseHttpClient(Darwin.create())
}
```

## API Client Wrapper

### commonMain - data/remote/ApiClient.kt
```kotlin
package com.cooleymd.reminders.data.remote

import io.ktor.client.*

class ApiClient(private val httpClient: HttpClient) {
    // Base URL will be configured when backend exists
    companion object {
        const val BASE_URL = "https://api.example.com" // placeholder
    }

    // API methods will be added in F5.x features
}
```

## Koin Integration

Add to AppModule.kt:
```kotlin
single { createHttpClient() }
single { ApiClient(get()) }
```

## Verification
```bash
./gradlew build
```

## Files to Create/Modify
- `gradle/libs.versions.toml` - add ktor dependencies
- `build.gradle.kts` (root) - add serialization plugin
- `composeApp/build.gradle.kts` - add ktor and serialization
- `composeApp/src/commonMain/kotlin/.../data/remote/HttpClientFactory.kt`
- `composeApp/src/androidMain/kotlin/.../data/remote/HttpClientFactory.kt`
- `composeApp/src/iosMain/kotlin/.../data/remote/HttpClientFactory.kt`
- `composeApp/src/commonMain/kotlin/.../data/remote/ApiClient.kt`
- `composeApp/src/commonMain/kotlin/.../di/AppModule.kt` - add client to DI
