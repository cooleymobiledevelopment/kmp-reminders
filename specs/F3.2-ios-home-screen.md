# F3.2: iOS Home Screen - Reminder List

## Objective
Implement the home screen with reminder list, grouped by time sections.

## Dependencies
- F3.1 (Navigation setup)
- F1.4 (GetRemindersUseCase via shared KMP module)

## Requirements
- [ ] ViewModel/ObservableObject for home screen with UI state
- [ ] List with reminder rows
- [ ] Grouping: Today, Upcoming, Completed sections
- [ ] Pull-to-refresh (placeholder for sync)
- [ ] Empty state when no reminders
- [ ] Add button in toolbar

## KMP Bridge Setup

### iosApp/KMP/KMPBridge.swift
```swift
import Foundation
import Shared // Import your KMP shared module

class KMPBridge {
    static let shared = KMPBridge()

    private init() {
        // Initialize Koin for iOS
        KoinHelper.shared.doInit()
    }

    var reminderRepository: ReminderRepository {
        KoinHelper.shared.getReminderRepository()
    }

    var getRemindersUseCase: GetRemindersUseCase {
        KoinHelper.shared.getGetRemindersUseCase()
    }
}
```

## ViewModel

### iosApp/Screens/Home/HomeViewModel.swift
```swift
import Foundation
import Combine
import Shared

@MainActor
class HomeViewModel: ObservableObject {
    @Published var uiState = HomeUiState()

    private let getRemindersUseCase: GetRemindersUseCase
    private var cancellables = Set<AnyCancellable>()

    init(getRemindersUseCase: GetRemindersUseCase = KMPBridge.shared.getRemindersUseCase) {
        self.getRemindersUseCase = getRemindersUseCase
        loadReminders()
    }

    func loadReminders() {
        uiState.isLoading = true

        // Use Kotlin Flow collector for iOS
        getRemindersUseCase.invoke(filter: .all)
            .watch { [weak self] reminders in
                guard let self = self, let reminders = reminders as? [Reminder] else { return }

                Task { @MainActor in
                    self.uiState.isLoading = false
                    self.uiState.todayReminders = reminders.filter { $0.isToday() }
                    self.uiState.upcomingReminders = reminders.filter { $0.isUpcoming() }
                    self.uiState.completedReminders = reminders.filter { $0.status == .completed }
                }
            }
    }

    func onRefresh() async {
        // Placeholder for sync - will be implemented in Phase 5
        try? await Task.sleep(nanoseconds: 500_000_000)
    }
}

struct HomeUiState {
    var isLoading: Bool = true
    var todayReminders: [Reminder] = []
    var upcomingReminders: [Reminder] = []
    var completedReminders: [Reminder] = []
    var error: String? = nil

    var isEmpty: Bool {
        todayReminders.isEmpty && upcomingReminders.isEmpty && completedReminders.isEmpty
    }
}
```

## Home Screen UI

### iosApp/Screens/Home/HomeScreen.swift
```swift
import SwiftUI
import Shared

struct HomeScreen: View {
    @StateObject private var viewModel = HomeViewModel()

    var onAddTapped: () -> Void
    var onReminderTapped: (String) -> Void

    var body: some View {
        Group {
            if viewModel.uiState.isLoading {
                ProgressView()
                    .frame(maxWidth: .infinity, maxHeight: .infinity)
            } else if viewModel.uiState.isEmpty {
                EmptyStateView(
                    message: "No reminders yet",
                    actionLabel: "Add your first reminder",
                    onAction: onAddTapped
                )
            } else {
                ReminderListView(
                    todayReminders: viewModel.uiState.todayReminders,
                    upcomingReminders: viewModel.uiState.upcomingReminders,
                    completedReminders: viewModel.uiState.completedReminders,
                    onReminderTapped: onReminderTapped
                )
                .refreshable {
                    await viewModel.onRefresh()
                }
            }
        }
        .navigationTitle("Reminders")
        .toolbar {
            ToolbarItem(placement: .primaryAction) {
                Button(action: onAddTapped) {
                    Image(systemName: "plus")
                }
            }
        }
    }
}
```

## Reminder List with Sections

### iosApp/Screens/Home/ReminderListView.swift
```swift
import SwiftUI
import Shared

struct ReminderListView: View {
    let todayReminders: [Reminder]
    let upcomingReminders: [Reminder]
    let completedReminders: [Reminder]
    let onReminderTapped: (String) -> Void

    var body: some View {
        List {
            if !todayReminders.isEmpty {
                Section("Today") {
                    ForEach(todayReminders, id: \.id) { reminder in
                        ReminderRowView(reminder: reminder)
                            .onTapGesture {
                                onReminderTapped(reminder.id)
                            }
                    }
                }
            }

            if !upcomingReminders.isEmpty {
                Section("Upcoming") {
                    ForEach(upcomingReminders, id: \.id) { reminder in
                        ReminderRowView(reminder: reminder)
                            .onTapGesture {
                                onReminderTapped(reminder.id)
                            }
                    }
                }
            }

            if !completedReminders.isEmpty {
                Section("Completed") {
                    ForEach(completedReminders, id: \.id) { reminder in
                        ReminderRowView(reminder: reminder)
                            .onTapGesture {
                                onReminderTapped(reminder.id)
                            }
                    }
                }
            }
        }
        .listStyle(.insetGrouped)
    }
}
```

## Reminder Row

### iosApp/Screens/Home/ReminderRowView.swift
```swift
import SwiftUI
import Shared

struct ReminderRowView: View {
    let reminder: Reminder

    var body: some View {
        VStack(alignment: .leading, spacing: 4) {
            Text(reminder.title)
                .font(.headline)
                .strikethrough(reminder.status == .completed)
                .foregroundColor(reminder.status == .completed ? .secondary : .primary)

            if let notes = reminder.notes, !notes.isEmpty {
                Text(notes)
                    .font(.subheadline)
                    .foregroundColor(.secondary)
                    .lineLimit(1)
            }

            Text(reminder.scheduledAt.formatForDisplay())
                .font(.caption)
                .foregroundColor(.secondary)
        }
        .padding(.vertical, 4)
    }
}
```

## Empty State Component

### iosApp/Components/EmptyStateView.swift
```swift
import SwiftUI

struct EmptyStateView: View {
    let message: String
    let actionLabel: String
    let onAction: () -> Void

    var body: some View {
        VStack(spacing: 16) {
            Image(systemName: "bell.slash")
                .font(.system(size: 60))
                .foregroundColor(.secondary)

            Text(message)
                .font(.headline)
                .foregroundColor(.secondary)

            Button(action: onAction) {
                Text(actionLabel)
                    .fontWeight(.medium)
            }
            .buttonStyle(.borderedProminent)
        }
        .frame(maxWidth: .infinity, maxHeight: .infinity)
    }
}
```

## Date Formatting Extension

### iosApp/Extensions/InstantExtensions.swift
```swift
import Foundation
import Shared

extension Kotlinx_datetimeInstant {
    func formatForDisplay() -> String {
        let date = Date(timeIntervalSince1970: TimeInterval(epochSeconds))
        let formatter = DateFormatter()

        if Calendar.current.isDateInToday(date) {
            formatter.dateFormat = "h:mm a"
            return "Today, \(formatter.string(from: date))"
        } else if Calendar.current.isDateInTomorrow(date) {
            formatter.dateFormat = "h:mm a"
            return "Tomorrow, \(formatter.string(from: date))"
        } else {
            formatter.dateFormat = "MMM d, h:mm a"
            return formatter.string(from: date)
        }
    }
}
```

## Verification
```bash
# Open iosApp in Xcode and run
# Home screen shows sections when reminders exist
# Empty state shows when no reminders
# Pull to refresh triggers refresh
# Tapping reminder navigates to edit screen
# Tapping + navigates to add screen
```

## Files to Create
- `iosApp/iosApp/KMP/KMPBridge.swift`
- `iosApp/iosApp/Screens/Home/HomeViewModel.swift`
- `iosApp/iosApp/Screens/Home/HomeScreen.swift`
- `iosApp/iosApp/Screens/Home/ReminderListView.swift`
- `iosApp/iosApp/Screens/Home/ReminderRowView.swift`
- `iosApp/iosApp/Components/EmptyStateView.swift`
- `iosApp/iosApp/Extensions/InstantExtensions.swift`
