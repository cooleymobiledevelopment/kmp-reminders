# F3.4: iOS Reminder Detail and Actions

## Objective
Add swipe actions, context menu, and quick snooze functionality to reminder rows.

## Dependencies
- F3.2 (Home screen)
- F1.5 (Snooze/Complete use cases)

## Requirements
- [ ] Swipe left to delete (with confirmation)
- [ ] Swipe right to complete
- [ ] Quick snooze presets (5m, 15m, 30m, 1h)
- [ ] Context menu on long press
- [ ] Complete/uncomplete toggle
- [ ] Delete confirmation alert

## Updated Home ViewModel

### Add action handlers to HomeViewModel.swift
```swift
import Foundation
import Combine
import Shared

@MainActor
class HomeViewModel: ObservableObject {
    // ... existing properties ...

    @Published var reminderToDelete: Reminder? = nil
    @Published var showDeleteConfirmation: Bool = false

    private let completeReminderUseCase: CompleteReminderUseCase
    private let snoozeReminderUseCase: SnoozeReminderUseCase
    private let deleteReminderUseCase: DeleteReminderUseCase

    init(
        getRemindersUseCase: GetRemindersUseCase = KMPBridge.shared.getRemindersUseCase,
        completeReminderUseCase: CompleteReminderUseCase = KMPBridge.shared.completeReminderUseCase,
        snoozeReminderUseCase: SnoozeReminderUseCase = KMPBridge.shared.snoozeReminderUseCase,
        deleteReminderUseCase: DeleteReminderUseCase = KMPBridge.shared.deleteReminderUseCase
    ) {
        self.getRemindersUseCase = getRemindersUseCase
        self.completeReminderUseCase = completeReminderUseCase
        self.snoozeReminderUseCase = snoozeReminderUseCase
        self.deleteReminderUseCase = deleteReminderUseCase
        loadReminders()
    }

    func onCompleteReminder(id: String) {
        Task {
            try? await completeReminderUseCase.invoke(id: id)
        }
    }

    func onSnoozeReminder(id: String, duration: SnoozeDuration) {
        Task {
            try? await snoozeReminderUseCase.invoke(id: id, duration: duration.toKotlinDuration())
        }
    }

    func onDeleteReminder(id: String) {
        Task {
            try? await deleteReminderUseCase.invoke(id: id)
        }
    }

    func confirmDelete(reminder: Reminder) {
        reminderToDelete = reminder
        showDeleteConfirmation = true
    }

    func executeDelete() {
        guard let reminder = reminderToDelete else { return }
        onDeleteReminder(id: reminder.id)
        reminderToDelete = nil
        showDeleteConfirmation = false
    }

    func cancelDelete() {
        reminderToDelete = nil
        showDeleteConfirmation = false
    }
}

enum SnoozeDuration: String, CaseIterable, Identifiable {
    case fiveMinutes = "5 minutes"
    case fifteenMinutes = "15 minutes"
    case thirtyMinutes = "30 minutes"
    case oneHour = "1 hour"

    var id: String { rawValue }

    func toKotlinDuration() -> Kotlinx_datetimeDateTimePeriod {
        switch self {
        case .fiveMinutes:
            return Kotlinx_datetimeDateTimePeriod(minutes: 5)
        case .fifteenMinutes:
            return Kotlinx_datetimeDateTimePeriod(minutes: 15)
        case .thirtyMinutes:
            return Kotlinx_datetimeDateTimePeriod(minutes: 30)
        case .oneHour:
            return Kotlinx_datetimeDateTimePeriod(hours: 1)
        }
    }
}
```

## Swipeable Reminder Row

### iosApp/Screens/Home/SwipeableReminderRow.swift
```swift
import SwiftUI
import Shared

struct SwipeableReminderRow: View {
    let reminder: Reminder
    let onTap: () -> Void
    let onComplete: () -> Void
    let onDelete: () -> Void
    let onSnooze: (SnoozeDuration) -> Void

    var body: some View {
        ReminderRowView(reminder: reminder)
            .contentShape(Rectangle())
            .onTapGesture(perform: onTap)
            .swipeActions(edge: .leading, allowsFullSwipe: true) {
                Button {
                    onComplete()
                } label: {
                    Label(
                        reminder.status == .completed ? "Uncomplete" : "Complete",
                        systemImage: reminder.status == .completed ? "arrow.uturn.backward" : "checkmark"
                    )
                }
                .tint(.green)
            }
            .swipeActions(edge: .trailing, allowsFullSwipe: false) {
                Button(role: .destructive) {
                    onDelete()
                } label: {
                    Label("Delete", systemImage: "trash")
                }
            }
            .contextMenu {
                // Complete/Uncomplete
                Button {
                    onComplete()
                } label: {
                    Label(
                        reminder.status == .completed ? "Mark Incomplete" : "Mark Complete",
                        systemImage: reminder.status == .completed ? "circle" : "checkmark.circle"
                    )
                }

                // Snooze submenu
                if reminder.status != .completed {
                    Menu {
                        ForEach(SnoozeDuration.allCases) { duration in
                            Button {
                                onSnooze(duration)
                            } label: {
                                Text(duration.rawValue)
                            }
                        }
                    } label: {
                        Label("Snooze", systemImage: "clock.arrow.circlepath")
                    }
                }

                Divider()

                // Delete
                Button(role: .destructive) {
                    onDelete()
                } label: {
                    Label("Delete", systemImage: "trash")
                }
            }
    }
}
```

## Updated Reminder List

### Update iosApp/Screens/Home/ReminderListView.swift
```swift
import SwiftUI
import Shared

struct ReminderListView: View {
    let todayReminders: [Reminder]
    let upcomingReminders: [Reminder]
    let completedReminders: [Reminder]
    let onReminderTapped: (String) -> Void
    let onComplete: (String) -> Void
    let onDelete: (Reminder) -> Void
    let onSnooze: (String, SnoozeDuration) -> Void

    var body: some View {
        List {
            if !todayReminders.isEmpty {
                Section("Today") {
                    ForEach(todayReminders, id: \.id) { reminder in
                        SwipeableReminderRow(
                            reminder: reminder,
                            onTap: { onReminderTapped(reminder.id) },
                            onComplete: { onComplete(reminder.id) },
                            onDelete: { onDelete(reminder) },
                            onSnooze: { duration in onSnooze(reminder.id, duration) }
                        )
                    }
                }
            }

            if !upcomingReminders.isEmpty {
                Section("Upcoming") {
                    ForEach(upcomingReminders, id: \.id) { reminder in
                        SwipeableReminderRow(
                            reminder: reminder,
                            onTap: { onReminderTapped(reminder.id) },
                            onComplete: { onComplete(reminder.id) },
                            onDelete: { onDelete(reminder) },
                            onSnooze: { duration in onSnooze(reminder.id, duration) }
                        )
                    }
                }
            }

            if !completedReminders.isEmpty {
                Section("Completed") {
                    ForEach(completedReminders, id: \.id) { reminder in
                        SwipeableReminderRow(
                            reminder: reminder,
                            onTap: { onReminderTapped(reminder.id) },
                            onComplete: { onComplete(reminder.id) },
                            onDelete: { onDelete(reminder) },
                            onSnooze: { duration in onSnooze(reminder.id, duration) }
                        )
                    }
                }
            }
        }
        .listStyle(.insetGrouped)
    }
}
```

## Updated Home Screen

### Update iosApp/Screens/Home/HomeScreen.swift
```swift
import SwiftUI
import Shared

struct HomeScreen: View {
    @StateObject private var viewModel = HomeViewModel()

    var onAddTapped: () -> Void
    var onReminderTapped: (String) -> Void

    var body: some View {
        Group {
            if viewModel.uiState.isLoading {
                ProgressView()
                    .frame(maxWidth: .infinity, maxHeight: .infinity)
            } else if viewModel.uiState.isEmpty {
                EmptyStateView(
                    message: "No reminders yet",
                    actionLabel: "Add your first reminder",
                    onAction: onAddTapped
                )
            } else {
                ReminderListView(
                    todayReminders: viewModel.uiState.todayReminders,
                    upcomingReminders: viewModel.uiState.upcomingReminders,
                    completedReminders: viewModel.uiState.completedReminders,
                    onReminderTapped: onReminderTapped,
                    onComplete: { id in viewModel.onCompleteReminder(id: id) },
                    onDelete: { reminder in viewModel.confirmDelete(reminder: reminder) },
                    onSnooze: { id, duration in viewModel.onSnoozeReminder(id: id, duration: duration) }
                )
                .refreshable {
                    await viewModel.onRefresh()
                }
            }
        }
        .navigationTitle("Reminders")
        .toolbar {
            ToolbarItem(placement: .primaryAction) {
                Button(action: onAddTapped) {
                    Image(systemName: "plus")
                }
            }
        }
        .alert("Delete Reminder", isPresented: $viewModel.showDeleteConfirmation) {
            Button("Cancel", role: .cancel) {
                viewModel.cancelDelete()
            }
            Button("Delete", role: .destructive) {
                viewModel.executeDelete()
            }
        } message: {
            if let reminder = viewModel.reminderToDelete {
                Text("Are you sure you want to delete '\(reminder.title)'?")
            }
        }
    }
}
```

## Verification
```bash
# Open iosApp in Xcode and run
# Swipe right on a reminder to complete it
# Swipe left on a reminder to reveal delete
# Long press to see context menu
# Snooze options work from context menu
# Delete confirmation appears before deletion
```

## Files to Create/Modify
- `iosApp/iosApp/Screens/Home/SwipeableReminderRow.swift`
- Update `iosApp/iosApp/Screens/Home/HomeViewModel.swift` with action handlers
- Update `iosApp/iosApp/Screens/Home/ReminderListView.swift` with swipe actions
- Update `iosApp/iosApp/Screens/Home/HomeScreen.swift` with delete confirmation
- Update `iosApp/iosApp/KMP/KMPBridge.swift` to expose action use cases
