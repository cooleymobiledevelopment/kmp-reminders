# F1.1: Reminder Model & Repository

## Objective
Create the Reminder domain model and repository for CRUD operations.

## Dependencies
- F0.2 (SQLDelight setup)
- F0.3 (Koin DI setup)

## Requirements
- [ ] `Reminder` data class in domain layer
- [ ] `ReminderRepository` interface in domain layer
- [ ] `ReminderRepositoryImpl` using SQLDelight in data layer
- [ ] All CRUD operations working (create, read, update, delete)
- [ ] Repository registered in Koin
- [ ] Unit tests for repository

## Domain Model

### domain/model/Reminder.kt
```kotlin
package com.cooleymd.reminders.domain.model

import kotlinx.datetime.Instant

data class Reminder(
    val id: String,
    val title: String,
    val notes: String? = null,
    val scheduledAt: Instant,
    val recurrenceRule: RecurrenceRule? = null,
    val status: ReminderStatus = ReminderStatus.PENDING,
    val snoozedUntil: Instant? = null,
    val completedAt: Instant? = null,
    val labelId: String? = null,
    val priority: Priority = Priority.NORMAL,
    val createdAt: Instant,
    val updatedAt: Instant
)

enum class ReminderStatus {
    PENDING, TRIGGERED, SNOOZED, COMPLETED, DISMISSED
}

enum class Priority {
    LOW, NORMAL, HIGH
}
```

## Repository Interface

### domain/repository/ReminderRepository.kt
```kotlin
package com.cooleymd.reminders.domain.repository

import com.cooleymd.reminders.domain.model.Reminder
import kotlinx.coroutines.flow.Flow

interface ReminderRepository {
    fun getAllReminders(): Flow<List<Reminder>>
    suspend fun getReminderById(id: String): Reminder?
    suspend fun insertReminder(reminder: Reminder)
    suspend fun updateReminder(reminder: Reminder)
    suspend fun deleteReminder(id: String)
}
```

## Repository Implementation

### data/repository/ReminderRepositoryImpl.kt
```kotlin
package com.cooleymd.reminders.data.repository

import com.cooleymd.reminders.data.local.RemindersDatabase
import com.cooleymd.reminders.domain.model.Reminder
import com.cooleymd.reminders.domain.repository.ReminderRepository
import app.cash.sqldelight.coroutines.asFlow
import app.cash.sqldelight.coroutines.mapToList
import kotlinx.coroutines.flow.Flow
import kotlinx.coroutines.flow.map

class ReminderRepositoryImpl(
    private val database: RemindersDatabase
) : ReminderRepository {

    private val queries = database.reminderQueries

    override fun getAllReminders(): Flow<List<Reminder>> {
        return queries.selectAll()
            .asFlow()
            .mapToList(Dispatchers.IO)
            .map { list -> list.map { it.toDomain() } }
    }

    override suspend fun getReminderById(id: String): Reminder? {
        return queries.selectById(id).executeAsOneOrNull()?.toDomain()
    }

    override suspend fun insertReminder(reminder: Reminder) {
        queries.insert(
            id = reminder.id,
            title = reminder.title,
            // ... map all fields
        )
    }

    override suspend fun updateReminder(reminder: Reminder) {
        queries.update(/* fields */)
    }

    override suspend fun deleteReminder(id: String) {
        queries.delete(id)
    }
}
```

## Mapper Functions

### data/repository/ReminderMapper.kt
```kotlin
fun DbReminder.toDomain(): Reminder { /* map DB to domain */ }
fun Reminder.toDb(): DbReminder { /* map domain to DB */ }
```

## Koin Registration

Add to AppModule.kt:
```kotlin
single<ReminderRepository> { ReminderRepositoryImpl(get()) }
```

## Tests

### commonTest/kotlin/.../ReminderRepositoryTest.kt
- Test insert and retrieve
- Test update
- Test delete
- Test getAllReminders flow

## Verification
```bash
./gradlew build
./gradlew :composeApp:testDebugUnitTest --tests "*ReminderRepository*"
```

## Files to Create
- `composeApp/src/commonMain/kotlin/.../domain/model/Reminder.kt`
- `composeApp/src/commonMain/kotlin/.../domain/repository/ReminderRepository.kt`
- `composeApp/src/commonMain/kotlin/.../data/repository/ReminderRepositoryImpl.kt`
- `composeApp/src/commonMain/kotlin/.../data/repository/ReminderMapper.kt`
- `composeApp/src/commonTest/kotlin/.../ReminderRepositoryTest.kt`
- Update `di/AppModule.kt`
